source [find interface/ftdi/olimex-jtag-tiny.cfg]
adapter_khz 1000
transport select jtag
reset_config trst_and_srst

jtag newtap auto0 tap -irlen 5 -expected-id 0x1762824f

target create cpu mips_m4k -endian little -chain-position auto0.tap
cpu configure -work-area-phys 0xa0001000 -work-area-size 0x1000

proc linkit_init { } {
	# PLL
	mdw 0xb0000028

	#mww 0xb000002c 0xXXXXXXXX | 1

	mww 0xb000002c 0x0020100d
	mww 0xb0000440 0x00030a01
	mww 0xb000002c 0x0020100c

	# RAM
	mww 0xb0000034 0x04000400
	sleep 1
	mww 0xb0001100 0x81c00000
	mww 0xb000110c 0x00010020
	sleep 20
	mww 0xb000110c 0x00050020
	mww 0xb0001104 0x00005580

	mww 0xb0001704 0x00000c0c
	mww 0xb000170c 0x00000202
	mww 0xb0001710 0x60001000
	mww 0xb0001714 0x00000404
	mww 0xb0001718 0x60001000
	mww 0xb000171c 0x00000c0c

	mww 0xb0000034 0x04000000

	mww 0xb0000348 0x68000c43
	mww 0xb000034c 0x00000452
	mww 0xb0000344 0x22362323

	mww 0xb0000314 0x0d000001
	mww 0xb0000310 0x0e120011

	# ddr_calibrate()
	mww 0xb0000440 0x00030901
	sleep 1
	mww 0xb0000440 0x00030801
	sleep 1
	mww 0xb0000440 0x00030701
	sleep 1
	mww 0xb0000440 0x00030601
	sleep 1
	mww 0xb0000440 0x00030501
	sleep 1
	mww 0xb0000440 0x00030401
	sleep 1
	mww 0xb0000440 0x00030301
	sleep 1
	mww 0xb0000440 0x00030201
	sleep 1
	mww 0xb0000440 0x00030101
	sleep 1

	mww 0xb0000310 0x0e120001
	mww 0xb0000364 0x00008888
	mww 0xb0000348 0x68000c43
	mww 0xb0000310 0x0e120011
}
